# Data import
train <- read.csv("train.csv", stringsAsFactors=FALSE, sep=",", dec = ".")
test <- read.csv("test.csv", stringsAsFactors=FALSE, sep=",", dec = ".")


# Quickly check data set
str(train)
summary(train)


# Feature engineering function
setup_predictors <- function(df){
  
  # Factors
  df$season <- factor(df$season)
  df$year <- factor(as.numeric(substr(as.Date(df$datetime), 1, 4)), levels = unique(as.numeric(substr(as.Date(df$datetime), 1, 4))))
  df$month <- factor(months(as.Date(df$datetime)), levels = unique(months(as.Date(df$datetime))))
  df$wday <- factor(weekdays(as.Date(df$datetime)), levels = unique(weekdays(as.Date(df$datetime))))
  df$hour <- factor(as.numeric(substr(df$datetime,12,13)))
  
  # create centered continious variables
  df$temp_c <- df$temp-mean(df$temp)
  df$atemp_c <- df$atemp-mean(df$atemp)
  df$humidity_c <- df$humidity-mean(df$humidity)
  df$windspeed_c <-df$windspeed-mean(df$windspeed)
  
  df
}


# Training data
Xtrain <- setup_predictors(train)

# Testing data
Xtest <- setup_predictors(test)


# Distribution of dependent variables
# OBVIOUSLY ZERO INFLATION
hist(Xtrain$casual)
hist(Xtrain$registered)


# Scatterplot (10% random sample for better visualization)
# Better use a big screen for this...
m <- nrow(Xtrain)
set.seed(1)
n <- sample(m, 0.1*m)
pairs(Xtrain[n,5:11])


# Try different plots of predictors and dependent variables...
plot(Xtrain$humidity, Xtrain$casual)

# Modeling Approach
# - Zero-inflated Count Data Model
# - use splines (smoothing) for continious predictors
# - use year, month, wday, hour as factors
# - use interaction variables
